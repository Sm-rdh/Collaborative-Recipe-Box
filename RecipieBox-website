<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Recipe Box</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

    <div class="container mx-auto max-w-4xl p-8">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8">My Recipe Box</h1>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

            <!-- === Add New Recipe Form (Column 1) === -->
            <div class="md:col-span-1 bg-white p-6 rounded-lg shadow-lg h-fit">
                <h2 class="text-2xl font-semibold mb-4">Add a New Recipe</h2>
                <form id="add-recipe-form" class="space-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Recipe Name</label>
                        <input type="text" id="name" name="name" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="ingredients" class="block text-sm font-medium text-gray-700">Ingredients (one per line)</label>
                        <textarea id="ingredients" name="ingredients" rows="5" required
                                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    <div>
                        <label for="instructions" class="block text-sm font-medium text-gray-700">Instructions</label>
                        <textarea id="instructions" name="instructions" rows="7" required
                                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    <button type="submit"
                            class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300">
                        Add Recipe
                    </button>
                    <p id="form-message" class="text-sm text-center"></p>
                </form>
            </div>

            <!-- === Recipe List (Column 2) === -->
            <div class="md:col-span-2">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">All Recipes</h2>
                <p id="loading-message" class="text-gray-500">Loading recipes...</p>
                <div id="recipe-list" class="space-y-6">
                    <!-- Recipes will be dynamically inserted here -->
                </div>
            </div>

        </div>
    </div>

    <script>
        const BACKEND_URL = 'http://localhost:8080';

        // 1. Fetch and display all recipes on page load
        document.addEventListener('DOMContentLoaded', fetchRecipes);

        async function fetchRecipes() {
            try {
                const response = await fetch(BACKEND_URL + '/api/recipes');
                const recipes = await response.json();

                const recipeList = document.getElementById('recipe-list');
                recipeList.innerHTML = ''; // Clear the list

                if (recipes.length === 0) {
                    recipeList.innerHTML = '<p class="text-gray-500">No recipes found. Add one to get started!</p>';
                } else {
                    recipes.forEach(recipe => {
                        recipeList.appendChild(createRecipeCard(recipe));
                    });
                }
                document.getElementById('loading-message').style.display = 'none';

            } catch (error) {
                console.error('Error fetching recipes:', error);
                document.getElementById('loading-message').textContent = 'Error: Could not load recipes. Is the backend server running?';
            }
        }

        // 2. Helper to create the HTML for a single recipe card
        function createRecipeCard(recipe) {
            const card = document.createElement('div');
            card.className = 'bg-white p-6 rounded-lg shadow-lg';
            
            // Ingredients list (split by newline, map to <li> tags)
            const ingredientsList = recipe.ingredients.split('\n')
                .map(item => `<li class="list-disc ml-5">${item}</li>`)
                .join('');

            card.innerHTML = `
                <h3 class="text-xl font-bold text-blue-600 mb-2">${recipe.name}</h3>
                <div class="flex justify-end -mt-8 -mr-2">
                    <button onclick="deleteRecipe('${recipe.id}')" 
                            class="text-gray-400 hover:text-red-500 font-bold py-1 px-2 rounded text-lg">&times;</button>
                </div>
                <div class="mb-4">
                    <h4 class="font-semibold text-gray-700">Ingredients:</h4>
                    <ul class="text-gray-600 mt-1">${ingredientsList}</ul>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-700">Instructions:</h4>
                    <p class="text-gray-600 mt-1 whitespace-pre-wrap">${recipe.instructions}</p>
                </div>
            `;
            return card;
        }

        // 3. Handle new recipe form submission
        const form = document.getElementById('add-recipe-form');
        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevent default form submission
            const formMessage = document.getElementById('form-message');
            
            const newRecipe = {
                name: document.getElementById('name').value,
                ingredients: document.getElementById('ingredients').value,
                instructions: document.getElementById('instructions').value
            };
            
            try {
                const response = await fetch(BACKEND_URL + '/api/recipes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newRecipe)
                });
                
                if (!response.ok) throw new Error('Failed to add recipe.');

                form.reset(); // Clear the form
                formMessage.textContent = 'Recipe added successfully!';
                formMessage.className = 'text-green-500 text-sm text-center';
                
                fetchRecipes(); // Refresh the recipe list
            } catch (error) {
                console.error('Error adding recipe:', error);
                formMessage.textContent = 'Error adding recipe.';
                formMessage.className = 'text-red-500 text-sm text-center';
            }
        });

        // 4. Handle recipe deletion
        async function deleteRecipe(id) {
            if (!confirm('Are you sure you want to delete this recipe?')) {
                return;
            }

            try {
                const response = await fetch(`${BACKEND_URL}/api/recipes/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Failed to delete recipe.');
                
                fetchRecipes(); // Refresh the recipe list
            } catch (error) {
                console.error('Error deleting recipe:', error);
                alert('Error: Could not delete the recipe.');
            }
        }
    </script>
</body>
</html>
